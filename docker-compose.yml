version: '2.1'
services:
  # --- Audio Init f√ºr WM8960 Mixer-Konfiguration ---
  audio-init:
    build: ./audio-init
    privileged: true
    devices:
      - "/dev/snd:/dev/snd"
      - "/dev/i2c-1:/dev/i2c-1"
    restart: always

  # --- Balena Audio Block ---
  audio:
    image: balenablocks/audio
    privileged: true
    depends_on:
      - audio-init

  # --- MagicMirror ---
  magicmirror:
    build: .
    restart: always
    network_mode: host
    privileged: true
    depends_on:
      - audio
      - audio-init
    environment:
      - PULSE_SERVER=tcp:localhost:4317
    devices:
      - "/dev/snd:/dev/snd"
      - "/dev/i2c-1:/dev/i2c-1"

  # --- Browser ---
  browser:
    image: balenablocks/browser
    privileged: true
    network_mode: host
    environment:
      LAUNCH_URL: 'http://localhost:8080'
      KIOSK: '1'
